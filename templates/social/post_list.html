{% extends 'base.html' %}

{% block title %}Feed{% endblock title %}

{% load crispy_forms_tags %}

{% block content %}
{% include 'navbar.html' %}
	<div class="container  d-md-none d-block">
    	<nav class="navbar sticky-top navbar-expand">
        	<div class="container">
        		<a href="{% url 'postlist' %}" class="navbar-brand">
            		<span class="fw-bold text-secondary"><strong> SKOLAR  </strong></span>
            	</a>
            </div>
        </nav>
    </div>

		<!-- POSTS -->
	<div class="main-content ">
		<div class="container mb-5 mt-2">
			<div class="row justify-content-between">
				<div class="col-md-9">
					{% for post in post_list %}
					<div class="row justify-content-center">
						<div class="col-md-8 card bg-black col-sm-12 border-bottom border-dark">
							<div class="card-header text-secondary">
								<a href="{% url 'profileview' post.author.profile.pk %}">
									<img class="rounded-circle post-img" height="30" width="30" src="{{ post.author.profile.picture.url }}" />
								</a>
								<p class="post-text">
									<a class="post-link text-primary" href="{% url 'profileview' post.author.profile.pk %}">@{{ post.author }} </a><small>{{ post.created_on }}</small>
								</p>
							</div>
							{% if post.video %}
								<video class="img-fluid card-img-top post-image" controls="controls" >
									<source src="{{ post.video.url }}" type="video/mp4" />
								</video>
								{% endif %}
							<div class=" card-body position-relative">
								{% if post.image %}
									<img src="{{ post.image.url }}" class="img-fluid card-img-top post-image" />
								{% endif %}
								
								<p class="my-2 text-white">
									<a class="post-link text-primary" href="{% url 'profileview' post.author.profile.pk %}"><small class="text-secondary">@{{ post.author }}_:</small>
									</a>
									{{ post.body }}
								</p>
								<a href="{% url 'postdetail' post.pk %}" class="stretched-link"></a>
							</div>

							<div class="d-flex flex-row card-footer mb-1 mt-3 ">
								<form method="POST" action="{% url 'like' post.pk %}">
									{% csrf_token %}
									<input type="hidden" name="next" value="{{ request.path }}">
									<button class="text-white remove-default-btn" type="submit"><i class="fa fa-thumbs-up"></i><span> {{ post.likes.all.count }}</span></button>
								</form>
								<form method="POST" action="{% url 'dislike' post.pk %}">
									{% csrf_token %}
									<input type="hidden" name="next" value="{{ request.path }}">
									<button class="text-white remove-default-btn" type="submit"><i class="fa fa-thumbs-down"></i><span> {{ post.dislikes.all.count }}</span></button>
								</form>
								<a class="ms-5 text-white post-link" href="{% url 'postdetail' post.pk %}"><i class="fa fa-comment"></i> comment</a>
							</div>
						</div>
					</div>
					{% endfor %}
				</div>
					
					<!-- LEADERBOARD -->

				<div  id="leaderboard" class="col-md-3 text-center d-none d-lg-block ">
					<p class="mb-3"><strong>Top 10 SKOLAR Users</strong></p>
					<div class="row justify-content-center">
						<div class="col-10">
							<ol>
								{% for item in top_users %}
								<li>
									<div class="row justify-content-center">
										<div class="col-12">
											<div class="mt-3">
												<a href="{% url 'profileview' item.user.profile.pk %}">
													<img class="rounded-circle post-img" height="30" width="30" src="{{ item.user.profile.picture.url }}" alt="Profile pic" />
												</a>
												<p class="post-text">
													<a class="post-link text-primary" href="{% url 'profileview' item.user.profile.pk %}"><strong>{{ item.user.username }}</strong></a> - <span class="badge bg-primary rounded-pill"> {{ item.score }}pts</span>
												</p>
											</div>
										</div>
									</div>
								</li>
								{% empty %}
								<li>No Posts yet this week!!</li>
								{% endfor %}
							</ol>
						</div>
					</div>
				</div>
			</div>
	</div>	
	</div>
	
{% endblock %}